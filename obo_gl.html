<!doctype html>
<html> <!-- tut @ http://learningwebgl.com/blog/?p=28 -->
	<head>
		<title>WebGL demo</title>
		<!-- import WebGL utility libraries -->
		<script src="js/webgl-utils.js" type="text/javascript"></script>
		<script src="js/gl-matrix-min.js" type="text/javascript"></script>
		<!-- import 3D models -->
		<script src="js/ball.js" type="text/javascript"></script>
		<script src="js/pill.js" type="text/javascript"></script>
		<script src="js/cube.js" type="text/javascript"></script> <!-- for testing reasons only -->
		<!-- import game specific code -->
		<script src="js/input.js" type="text/javascript"></script>
		<script src="js/gamelogic.js" type="text/javascript"></script>
		<script src="js/render.js" type="text/javascript"></script>
		<script id="shader-fs" type="x-shader/x-fragment">
			varying highp vec3 color;
			varying highp vec3 lighting;
			
			void main(void)
			{
				gl_FragColor = vec4(color * lighting, 1.0);
			}
		</script>
		<script id="shader-vs" type="x-shader/x-vertex">
			highp vec3 ambientLight          = vec3(0.60, 0.60, 0.60);
			highp vec3 directionalLightColor = vec3(0.50, 0.50, 0.75);
			highp vec3 directionalVector     = vec3(0.85, 0.80, 0.75);
			
			attribute highp vec3 vertexNormal;
			attribute highp vec3 vertexPosition;
			
			uniform highp vec3 meshColor; // every vertex of the same object has the same color
			uniform highp mat4 nMatrix;
			uniform highp mat4 mvMatrix;
			uniform highp mat4 projMatrix;
			
			varying highp vec3 color;
			varying highp vec3 lighting;

			void main(void)
			{
				highp vec4 transformedNormal = nMatrix * vec4(vertexNormal, 1.0);
				highp float directional      = max(dot(transformedNormal.xyz, directionalVector), 0.0);
				
				color       = meshColor;
				lighting    = ambientLight + (directionalLightColor * directional);
				
				gl_Position = projMatrix * mvMatrix * vec4(vertexPosition, 1.0);
			}
		</script>
		<script type="text/javascript">
			window.onload = function()
			{
				var canvas = document.getElementById("rc");
				
				initGL(canvas);
				initShaders();
				initBuffers(Pill);
				initBuffers(Ball);
				initBuffers(Cube);
				initEnvironment();	// create needed matrices for opengl and set perspective
				
				createGame();		// create all game instances (player, ball, ...)
				
				window.setInterval(animate, 30); // do animation in 30 ms interval
				
				// IMPORTANT: this function is NO blocking call
				// the render loop will be started in a new thread
				startMainLoop(); 
			};
		</script>
		<style type="text/css">
			body {
				text-align: center;
			}
			
			canvas#rc {
				position: relative;
				width: 800;
				height: 600;
				margin: 10px auto;
				text-align: left;
				box-shadow: 5px 5px 5px #888;
			}
		</style>
	</head>
	<body>
		<div id="fps"></div>
		<audio autoplay="autoplay" loop="loop">
			<source src="sound/ozzed_waterski_me.mp3" type="audio/mp3" />
			Your browser does not support the audio tag.
		</audio>
		
		<canvas width="800" height="600" id="rc">
			Your browser does not support the canvas element.
		</canvas>
	</body>
</html>
